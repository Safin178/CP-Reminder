<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Programming Contests</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .contest-card {
            background: #fff;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            white-space: pre-line;
            font-size: 16px;
            margin-bottom: 25px;
            width: 100%;
            max-width: 520px;
            display: flex;
            flex-direction: column;
        }

        .contest-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #1a73e8;
        }

        .contest-subheader {
            font-size: 16px;
            font-weight: 500;
            color: #555;
            margin-bottom: 10px;
        }

        .contest-info {
            white-space: pre-line;
            font-size: 15px;
            margin-bottom: 15px;
        }

        .btn-copy {
            padding: 12px 0;
            font-size: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            background-color: #34a853;
            color: #fff;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-copy:hover {
            background-color: #2c8e46;
            transform: translateY(-2px);
        }

        .btn-share {
            padding: 12px 0;
            font-size: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            background-color: #1a73e8;
            color: #fff;
            transition: all 0.3s;
            width: 100%;
            margin-top: 8px;
        }

        .btn-share:hover {
            background-color: #1558b0;
            transform: translateY(-2px);
        }

        .notification {
            color: #d9534f;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            body {
                padding: 8px;
            }

            .contest-card {
                padding: 12px;
                font-size: 15px;
                max-width: 98vw;
            }

            h1 {
                font-size: 22px;
            }

            .btn-copy {
                font-size: 15px;
                padding: 10px 0;
            }
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #181a20;
            color: #e0e6ed;
        }

        body.dark-mode .contest-card {
            background: #23272f;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode h1 {
            color: #e0e6ed;
        }

        body.dark-mode .contest-header {
            color: #90caf9;
        }

        body.dark-mode .btn-copy {
            background-color: #388e3c;
            color: #fff;
        }

        body.dark-mode .btn-copy:hover {
            background-color: #2c6e2a;
        }

        body.dark-mode .notification {
            color: #ffb4a2;
        }

        /* Platform Logo Styles */
        .platform-logo {
            height: 28px;
            width: 28px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 6px;
            background: #fff;
            object-fit: contain;
        }

        .contest-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Platform-specific Color Themes */
        .contest-card.cf {
            border-left: 8px solid #1a73e8;
            background: #e3f0ff;
        }

        .contest-card.cc {
            border-left: 8px solid #f44336;
            background: #ffeaea;
        }

        .contest-card.ac {
            border-left: 8px solid #2e7d32;
            background: #eaffea;
        }

        .contest-card.lc {
            border-left: 8px solid #ffb800;
            background: #fffbe3;
        }

        /* Dark mode overrides for platform themes */
        body.dark-mode .contest-card.cf {
            background: #23395d;
            border-left-color: #90caf9;
        }

        body.dark-mode .contest-card.cc {
            background: #4b2323;
            border-left-color: #ff7961;
        }

        body.dark-mode .contest-card.ac {
            background: #1b3c1b;
            border-left-color: #81c784;
        }

        body.dark-mode .contest-card.lc {
            background: #4d3c1b;
            border-left-color: #ffe082;
        }
    </style>
</head>

<body>
    <!-- Dark Mode Toggle Button -->
    <button id="toggle-dark"
        style="margin-bottom:18px; padding:8px 18px; border-radius:8px; border:none; background:#333; color:#fff; font-weight:600; cursor:pointer;">
        Toggle Dark Mode
    </button>

    <h1>Next Upcoming Contests</h1>
    <div id="notification" class="notification"></div>

    <div id="cf" class="contest-card cf">
        <div class="contest-header">
            <img src="https://sta.codeforces.com/s/84849/images/codeforces-logo-with-telegram.png" alt="Codeforces"
                class="platform-logo">
            Codeforces
        </div>
        <div class="contest-subheader" id="cf-sub">Round / Div info</div>
        <div class="contest-info" id="cf-info">Loading...</div>
        <button class="btn-copy" onclick="copyText('cf-info')">Copy Contest Info</button>
        <button class="btn-share" onclick="shareContest('cf-info')">Share</button>
    </div>

    <div id="cc" class="contest-card cc">
        <div class="contest-header">
            <img src="https://cdn.codechef.com/images/cc-logo.svg" alt="CodeChef" class="platform-logo">
            CodeChef
        </div>
        <div class="contest-subheader" id="cc-sub">Starters / Lunchtime</div>
        <div class="contest-info" id="cc-info">Loading...</div>
        <button class="btn-copy" onclick="copyText('cc-info')">Copy Contest Info</button>
        <button class="btn-share" onclick="shareContest('cc-info')">Share</button>
    </div>

    <div id="ac" class="contest-card ac">
        <div class="contest-header">
            <img src="https://img.atcoder.jp/assets/atcoder.png" alt="AtCoder" class="platform-logo">
            AtCoder
        </div>
        <div class="contest-subheader" id="ac-sub">Regular / Beginner / Grand</div>
        <div class="contest-info" id="ac-info">Loading...</div>
        <button class="btn-copy" onclick="copyText('ac-info')">Copy Contest Info</button>
        <button class="btn-share" onclick="shareContest('ac-info')">Share</button>
    </div>

    <div id="lc" class="contest-card lc">
        <div class="contest-header">
            <img src="https://leetcode.com/static/images/LeetCode_logo_rvs.png" alt="LeetCode" class="platform-logo">
            LeetCode
        </div>
        <div class="contest-subheader" id="lc-sub">Weekly / Biweekly Contest</div>
        <div class="contest-info" id="lc-info">Loading...</div>
        <button class="btn-copy" onclick="copyText('lc-info')">Copy Contest Info</button>
        <button class="btn-share" onclick="shareContest('lc-info')">Share</button>
    </div>

    <script>
        const username = 'safin17_8';
        const apiKey = '61dc8cb52e97f5778795d5f6e729e3b46b2103b8';
        const platforms = { cf: 1, cc: 2, ac: 93, lc: 102 };

        // Load saved data from localStorage
        let lastData = JSON.parse(localStorage.getItem('contestData')) || {
            cf: null, cc: null, ac: null, lc: null
        };
        for (let key in lastData) {
            if (lastData[key]) {
                document.getElementById(key + '-info').innerText = lastData[key];
            }
        }

        // Format date in BDT (Bangladesh Time) in the requested format
        function formatDate(utcDateStr) {
            // Parse the UTC date string correctly
            const date = new Date(utcDateStr); // Already UTC

            // Convert to BDT by adding 6 hours
            const bdtTime = new Date(date.getTime() + 6 * 60 * 60 * 1000);

            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday",
                "Thursday", "Friday", "Saturday"];

            const day = bdtTime.getDate().toString().padStart(2, '0');
            const month = months[bdtTime.getMonth()];
            const year = bdtTime.getFullYear();
            const weekday = weekdays[bdtTime.getDay()];

            let hours = bdtTime.getHours();
            const minutes = bdtTime.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // 0 -> 12
            const hourStr = hours.toString().padStart(2, '0');

            return `${month} ${day}, ${year} (${weekday}) at ${hourStr}:${minutes} ${ampm} BDT`;
        }

        async function fetchContest(platformKey, divId, subDivId) {
            const resourceId = platforms[platformKey];
            try {
                const res = await fetch(`https://clist.by/api/v1/contest/?username=${username}&api_key=${apiKey}&resource__id=${resourceId}&start__gte=${new Date().toISOString()}&order_by=start`);
                const data = await res.json();
                if (!data.objects || data.objects.length === 0) {
                    showNotification("No upcoming contests found. Try again later.");
                    return;
                }

                const next = data.objects[0];
                const formattedStart = formatDate(next.start);

                let durationHours = Math.floor(next.duration / 3600);
                let durationMinutes = Math.floor((next.duration % 3600) / 60);
                let durationStr = '';
                if (durationHours > 0) durationStr += durationHours + ' Hour' + (durationHours > 1 ? 's' : '');
                if (durationMinutes > 0) durationStr += (durationStr ? ' & ' : '') + durationMinutes + ' Minute' + (durationMinutes > 1 ? 's' : '');
                if (durationStr === '') durationStr = 'N/A';

                const contestInfo = `ðŸ”° ${next.event}\n\nStarting Time: ${formattedStart}\n\nDuration: ${durationStr}\n\nContest Link: ${next.href}`;

                lastData[platformKey] = contestInfo;
                document.getElementById(divId + '-info').innerText = contestInfo;

                document.getElementById(subDivId).innerText = next.event.includes("Starters") ? "Starters Contest" :
                    next.event.includes("Weekly") ? "Weekly Contest" :
                        next.event.includes("Div") ? "Round / Div" :
                            "Contest Info";

                localStorage.setItem('contestData', JSON.stringify(lastData));
                clearNotification();
            } catch (err) {
                console.error(err);
                if (lastData[platformKey]) document.getElementById(divId + '-info').innerText = lastData[platformKey];
                showNotification("Failed to fetch data. Wait some time and refresh.");
            }
        }

        function copyText(divId) {
            const text = document.getElementById(divId).innerText;
            navigator.clipboard.writeText(text).then(() => alert("Copied!")).catch(() => alert("Failed to copy"));
        }

        function shareContest(divId) {
            const text = document.getElementById(divId).innerText;
            if (navigator.share) {
                navigator.share({
                    title: 'Upcoming Contest',
                    text: text
                }).catch(() => alert("Share cancelled or failed."));
            } else {
                alert("Web Share API not supported on this browser.");
            }
        }

        function showNotification(msg) {
            document.getElementById('notification').innerText = msg;
        }

        function clearNotification() {
            document.getElementById('notification').innerText = '';
        }

        // Dark Mode Toggle Script
        document.getElementById('toggle-dark').onclick = function () {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        };
        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }

        // Initial fetch for all platforms
        for (let key in platforms) fetchContest(key, key, key + '-sub');
    </script>

</body>

</html>